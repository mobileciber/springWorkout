package de.ciber.comics.view.controller;

import java.io.IOException;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;

import de.ciber.comics.db.UserRepository;

/**
 * For simply dumping an avatar image blob
 */
@Controller
public class AvatarImageController {
	@Autowired
	UserRepository repository;

	@RequestMapping("/getImage/{id}")
	public void getImage(HttpServletRequest request,
			HttpServletResponse response, @PathVariable("id") final long id)
			throws IOException {
		response.setContentType("image/jpeg");

		byte[] imageBytes = repository.findOne(id).getAvatarImage();

		if (imageBytes == null || imageBytes.length <= 0) {
			imageBytes = defaultImage;
		}
		response.getOutputStream().write(imageBytes);
		response.getOutputStream().flush();
	}

	private static byte[] defaultImage = {
			-1,-40,-1,-32,0,16,74,70,73,70,0,1,1,0,0,1,0,1,0,0,-1,-37,0,-124,0,9,6,7,19,16,17,20,20,16,19,22,21,21,21,25,22,
			23,22,21,22,22,27,20,27,23,22,32,23,34,34,32,29,31,31,36,40,52,37,24,38,39,39,21,20,33,49,45,49,46,55,46,46,46,23,37,51,56,
			51,44,55,40,45,46,43,1,10,10,10,5,5,5,14,5,5,14,43,25,19,25,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,
			43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,-1,-64,0,17,8,0,68,0,68,3,
			1,34,0,2,17,1,3,17,1,-1,-60,0,27,0,0,2,3,1,1,1,0,0,0,0,0,0,0,0,0,0,0,6,1,4,5,3,7,2,-1,-60,0,
			52,16,0,1,3,0,6,7,6,5,5,0,0,0,0,0,0,0,1,0,2,3,4,5,6,17,33,81,20,49,51,65,114,-78,-47,18,97,113,-127,-110,-95,
			19,34,83,-111,-63,50,82,-79,-16,-15,-1,-60,0,20,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-60,0,20,17,1,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-38,0,12,3,1,0,2,17,3,17,0,63,0,-10,26,-66,-123,17,-118,50,99,97,37,-115,36,-106,-125,
			121,-20,-123,-33,64,-117,-23,71,-24,111,68,85,-69,24,-72,25,-54,21,-108,21,-76,8,-66,-108,126,-122,-12,89,-76,-38,101,18,35,113,99,9,-55,-84,105,92,109,
			77,104,99,31,13,-122,-25,56,124,-57,32,-108,80,53,71,92,-48,-55,-58,16,-34,-13,27,127,11,94,-115,5,30,65,-38,99,35,112,-18,107,87,-97,43,117,109,
			61,-48,60,57,-89,13,-29,113,8,30,-12,8,-66,-108,126,-122,-12,70,-127,23,-46,-113,-48,-34,-117,-83,30,96,-10,-121,55,81,23,-123,-47,2,-115,-90,-119,-84,-107,
			-95,-115,13,29,-128,110,104,3,30,-47,66,-5,-75,123,102,-16,14,98,-95,3,29,91,-79,-117,-127,-100,-95,89,85,-86,-35,-116,92,12,-27,10,-54,4,27,66,-30,
			105,18,95,-72,-35,-27,114,-50,91,-42,-74,-124,91,39,-60,31,-91,-38,-4,86,10,1,8,82,-58,23,16,6,36,-32,16,59,-39,103,19,71,109,-5,-119,30,87,
			-83,117,82,-85,-94,-4,40,-102,-51,-32,99,-30,-83,-96,84,-75,123,102,-16,14,98,-95,77,-85,-37,55,-128,115,21,8,24,-22,-35,-116,92,12,-27,10,-54,-83,86,
			-20,98,-32,103,40,86,74,14,84,-104,27,35,75,94,47,7,114,86,-89,89,103,-125,124,78,14,25,59,2,63,5,91,-83,-19,32,97,45,-122,-30,119,-72,-22,
			30,25,-91,-70,69,58,73,13,-17,123,-113,-98,31,100,23,-94,-77,-109,-109,-120,107,123,-53,-127,-2,19,21,79,81,50,15,-103,-57,-76,-4,-9,15,4,-112,-45,118,
			-84,60,22,-123,6,-69,-102,35,-6,-117,-122,78,-59,3,-14,22,125,85,90,-78,-112,48,-63,-61,91,79,-9,21,-96,-127,82,-43,-19,-101,-64,57,-118,-123,54,-81,108,
			-34,1,-52,84,32,99,-85,118,49,112,51,-108,44,-117,85,89,22,52,70,-61,-117,-75,-100,-126,-41,-85,118,49,112,51,-108,36,122,-14,110,-36,-14,28,-115,-61,-53,
			4,20,80,-124,32,16,-124,32,-21,68,-92,-70,39,-121,52,-36,66,-12,42,13,40,75,27,94,55,-113,-79,94,112,-101,44,100,-41,-79,-19,-3,-92,17,-25,-2,32,
			-81,106,-10,-51,-32,28,-59,66,-101,87,-74,111,0,-26,42,16,124,-61,104,37,99,90,-48,-42,92,-48,0,-68,29,64,93,-102,82,-91,-42,46,50,60,-36,-36,92,
			-29,-65,63,20,33,7,45,61,-39,15,126,-88,-45,-35,-112,-9,-22,-124,32,52,-9,100,61,-6,-93,79,118,67,-33,-86,16,-128,-45,-35,-112,-9,-22,-74,108,-35,115,
			36,102,78,-56,110,61,-99,96,-9,-9,-9,-95,8,46,-45,-23,-82,-99,-63,-49,0,16,46,-7,112,-62,-5,-1,0,40,66,16,127,-1,-39
	};
}
